@model AssociationBids.Portal.Model.InvitedVendorsModel

@{
    ViewBag.Title = "InviteVendorView";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/jquery-3.4.1.js"></script>

<script src="~/Content/themes/assets/js/vendors/jquery-3.2.1.min.js"></script>

<h2>InviteVendorView</h2>


<!-- app-content-->
<div class="app-content  my-3 my-md-5">
    <div class="side-app">

        <!-- page-header -->

        <div class="page-header">
            <ol class="breadcrumb">
                <!-- breadcrumb -->
                <li class="breadcrumb-item ">

                    @Html.ActionLink("Vendors", "PMVendorlist", "PMVendor", null, new { })
                </li>

                <li class="breadcrumb-item active text-left">Vendors Detail</li>

            </ol><!-- End breadcrumb -->

        </div>
        <!-- End page-header -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    @Html.HiddenFor(model => model.CompanyKey)

                    <div class="card-body">


                        <div class="form-div">

                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Company Information</h3>
                                            <div class="card-options">
                                                <a onclick=" EditPage();" class="btn btn-primary ml-auto  pull-right" style="display:none;" title="Edit"><i class="fa fa-pencil"></i> Edit</a>
                                                <a style="margin-left: 10px;" href="#" class="card-options-collapse mr-2" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                                            </div>
                                        </div>
                                        <div class="card-body border-top">
                                            </h4>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Company Name</label>
                                                        <p>@Model.CompanyName</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Work Phone 1</label>
                                                        <p>@Model.Work</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Work Phone 2</label>
                                                        <p>@Model.Work2</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Fax</label>
                                                        <p>@Model.Fax</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">Website</label>
                                                        <p>@Model.Website</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">Address 1</label>
                                                        <p>@Model.Address</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">Address 2</label>
                                                        <p>@Model.Address2</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">City</label>
                                                        @Model.City
                                                    </div>
                                                </div><!-- end of col -->
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">State</label>
                                                        @Model.State
                                                    </div>
                                                </div><!-- end of col -->

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">Zip</label>
                                                        @Model.Zip
                                                    </div>
                                                </div><!-- end of col -->

                                            </div><!-- end of row -->

                                        </div><!-- card body end -->
                                    </div><!-- card end -->
                                </div><!-- col end -->
                            </div><!-- row end -->



                            <div class="row">
                                <div class="col-12">
                                    <div class="card">

                                        <div class="card-header">
                                            <h3 class="card-title">Contact Information</h3>
                                            <div class="card-options">
                                                <a style="margin-left: 10px;" href="#" class="card-options-collapse mr-2" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                                            </div>
                                        </div>
                                        <div class="card-body border-top">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Name</label>
                                                        @Model.Name
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Work Phone 1</label>
                                                        @Model.Work
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Work Phone 2</label>
                                                        @Model.Work2
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label class="form-label">Cell Phone</label>
                                                        @Model.CellPhone
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="form-label">Email</label>
                                                        @Model.Email
                                                    </div>
                                                </div>

                                            </div><!-- end of row -->

                                        </div><!-- card body end -->
                                    </div><!-- card end -->
                                </div><!-- col end -->
                            </div>


                            <!-- row end -->
                            <!-- col end -->
                        </div><!-- row end -->

                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Services</h3>
                                        <div class="card-options">
                                            <a style="margin-left: 10px;" href="#" class="card-options-collapse mr-2" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                                        </div>
                                    </div>
                                    <div class="card-body border-top">
                                        <div id="divservc" class="table-responsive">
                                            <table id="dataTableExample" class="table table-striped table-bordered text-nowrap w-100 dataTable no-footer">
                                                <thead>
                                                    <tr>


                                                        <th>Title</th>
                                                        <th width="5%"></th>




                                                    </tr>

                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>

                                                            <span class="ser-fl"></span>
                                                        </td>
                                                        <td align="center">

                                                            <a title="Delete" onclick="removeser(this);"><i class="fe fe-trash redtxt font18"></i></a>
                                                        </td>

                                                    </tr>



                                                </tbody>
                                            </table>
                                        </div>

                                    </div><!-- card body end -->

                                    <div class="pagination" style="display:none;">

                                        <input type="hidden" id="HdnPageIndex" value="1" />
                                        <input type="hidden" id="PageSize" value="20" />
                                        <input type="hidden" id="TotalPageRecord" value='0' />
                                    </div>
                                </div><!-- card end -->
                            </div><!-- col end -->
                        </div>



                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Insurance</h3>
                                        <div class="card-options">
                                            <a style="margin-left: 10px;" href="#" class="card-options-collapse mr-2" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                                        </div>
                                    </div>
                                    <div class="card-body border-top">
                                        <div id="RawDatas" class="table-responsive">
                                            <table id="dataTableExample" class="table table-striped table-bordered text-nowrap w-100 dataTable no-footer">
                                                <thead>
                                                    <tr>

                                                        @*<th width="30%" ('PolicyNumber') style="cursor: pointer;">

                                                                Policy Number
                                                            </th>
                                                            <th width="30%" ('InsuranceAmount') style="cursor: pointer;">

                                                                Amount
                                                            </th>
                                                            <th width="30%" ('StartDate') style="cursor: pointer;">

                                                                Expiration
                                                            </th>
                                                            <th width="15%">&nbsp;</th>*@


                                                        <th>Document</th>
                                                        <th width="5%"></th>




                                                    </tr>

                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <input type="hidden" class="documentid" id="documentid" value="" />
                                                            <span class="documentname"></span>
                                                        </td>
                                                        <td align="center">

                                                            <a title="Delete" onclick="removedocu(this);"><i class="fe fe-trash redtxt font18"></i></a>
                                                        </td>

                                                        @*<td><span class="policynumber"></span></td>
                                                            <td><span class="insuranceamount"></span></td>
                                                            <td><span class="enddate"></span></td>

                                                            <td align="center"><a id="viewdata" class="badge badge-primary pull-right" data-toggle="modal" data-target="#viewinsurance"><i class="fa fa-certificate"></i> View Insurance</a></td>*@
                                                    </tr>



                                                </tbody>
                                            </table>
                                        </div>

                                    </div><!-- card body end -->

                                    <div class="pagination" style="display:none;">

                                        <input type="hidden" id="HdnPageIndex" value="1" />
                                        <input type="hidden" id="PageSize" value="20" />
                                        <input type="hidden" id="TotalPageRecord" value='0' />
                                    </div>
                                </div><!-- card end -->
                            </div><!-- col end -->
                        </div>


                        <!-- row end -->

                    </div><!-- end of form-div  -->

                </div><!--end of card body -->
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal fade" id="viewinsurance" tabindex="-1" role="dialog" aria-labelledby="uploadmodalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadmodalLabel">View Insurance</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Policy Number</label>
                                    <span id="PolicyNumber"></span>

                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">

                                    <label class="form-label">Amount</label>
                                    <span id="vInsuranceAmount"></span>

                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Start Date</label>
                                    <span id="vStartDate"></span>

                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">End Date</label>
                                    <span id="vEndDate"></span>

                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Renewal Date</label>
                                    <span id="vRenewalDate"></span>

                                </div>
                            </div>
                        </div>
                        <hr />


                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive" id="divFileUploader">
                                    <table id="dataTableExample" class="table table-striped table-bordered w-100 dataTable no-footer">
                                        <thead>
                                            <tr>
                                                <th width="30%" ('Description') style="cursor: pointer;">

                                                    Description
                                                </th>
                                                <th width="5%"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <span class="upd-fl"></span>
                                                </td>
                                                <td align="center"><a id="viewdata1" class="badge badge-primary pull-right" data-toggle="modal" data-target="#viewinsurance"><i class="fa fa-certificate"></i> View Insurance</a></td>

                                            </tr>
                                        </tbody>
                                    </table>

                                </div><!-- end of table responsive -->
                            </div><!-- end of col -->
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div><!-- end of modal-->



</div><!--End side app-->
<!--footer-->
<footer class="footer">
    <div class="container">
        <div class="row align-items-center flex-row-reverse">
            <div class="col-lg-12 col-sm-12   text-center">
                Copyright © 2020 Association Bids. All rights reserved.
            </div>
        </div>
    </div>
</footer>
<!-- End Footer-->
</div>
<!-- End app-content-->


<script>

    $(document).ready(function () {
        bindservice();
        bindDocument();
        insurancetableFill();

        $("#ddlload").hide();
        $(".advance_search").click(function () {
            $("#advancesearch3").toggle(500);
        });
        $(".overlayclose").click(function () {
            $("#advancesearch3").hide();
        });
        $('.loader-wrapper').show();
        $.get('/PMVendor/IndexinsurancePaging', { PageSize: 0, PageIndex: 1, Search: '', Sort: sorted }, function (response) {
            $("#RawDatas table tbody tr:eq(0)").hide();
            $(".loader-wrapper").hide();
        });

    });


    function insurancetableFill()
    {


        debugger;
         $.ajax({
            url: '@Url.Action("bindDocument", "PMVendor")',
            cache: false,
             data:
              {
                 CompanyKey: $('#CompanyKey').val()
              },
            success: function (response)
            {
                debugger;
                $("#RawDatas table tbody tr:not(:first)").remove();
                $("#RawDatas table tbody tr:eq(0)").show();
                for (var i = 0; i < response.length; i++)
                {
                    var cln = $("#RawDatas table tbody tr:eq(0)").clone(true);
                    $(".documentname", cln).html(response[i].FileName);
                    $(".documentid", cln).val(response[i].DocumentId);

                    $("#RawDatas table").append(cln);
                }
                $("#RawDatas table tbody tr:eq(0)").hide();
            }
        });




        @*debugger;
        $.ajax({

            url: '@Url.Action("IndexinsurancePaging", "PMVendor")',
            cache: false,
             data:
              {
                 CompanyKey: $('#CompanyKey').val()
              },
            success: function (response)
            {

                if (parseInt(response.length) > 0) {

                    var curRecords = 0;
                    var TotalRecs = 0;
                    debugger;
                    curRecords = parseInt(($('#HdnPageIndex').val()) * parseInt($('#PageSize').val()));
                    curRecords = curRecords - ($('#PageSize').val() - parseInt(response.length));
                    TotalRecs = parseInt(response[0].TotalRecords);
                    $('.spnOfRecs').text(curRecords);
                    $('.spnTotalRecs').text(TotalRecs);
                    if (curRecords === 0 || curRecords === TotalRecs) {
                        $("#ddlload").hide();
                    }
                    else {
                        $("#ddlload").show();
                    }
                } else {
                    $("#ddlload").hide();
                }
                $("#RawDatas table tbody tr:not(:first)").remove();
                $("#RawDatas table tbody tr:eq(0)").show();
                for (var i = 0; i < response.length; i++) {
                    var table = $("#RawDatas table tbody tr:eq(0)").clone(true);
                    $(".policynumber", table).html(response[i].PolicyNumber);
                    $(".insuranceamount", table).html(response[i].InsuranceAmount);
                    $(".enddate", table).html(ToJavaScriptDate(response[i].EndDate));
                    $("#viewdata", table).attr('href', '/PMVendor/VendorView?CompanyKey=' + response[i].CompanyKey);
                    $("#RawDatas table").append(table);
                }
                $("#RawDatas table tbody tr:eq(0)").hide();
                $("#vPolicyNumber").html(response[0].PolicyNumber);
                $("#vInsuranceAmount").html(response[0].InsuranceAmount);
                $("#vStartDate").html(ToJavaScriptDate(response[0].StartDate));
                $("#vEndDate").html(ToJavaScriptDate(response[0].EndDate));
                $("#vRenewalDate").html(ToJavaScriptDate(response[0].RenewalDate));
                $("#loading1").hide();
            }
        });*@
    }
    function ToJavaScriptDate(value) {
        var pattern = /Date\(([^)]+)\)/;
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
    }
    function EditPage()
    {
        var a = $("#CompanyKey").val();
        window.location.href = 'PMVendorEdit?CompanyKey=' + $("#CompanyKey").val();
    }



    function removeser(me) {
        debugger;
        var m = $(me).parent("td").parent("tr").find('.ser-fl').text();

        var a = $("#CompanyKey").val();
        var b = $(me).parent("td").parent("tr").find('.ser-fl').text();

        var r = confirm('Are you sure you want to delete this record?');
        if (r == true)
        {
            window.location.href = "DeleteService?CompanyKey=" + a + "&servicename=" + b;
        }


    }
    function removedocu(me) {
        debugger;
        var m = $(me).parent("td").parent("tr").find('.documentid').val();

        var a = $("#CompanyKey").val();


        var r = confirm('Are you sure you want to delete this record?');
        if (r == true) {
            window.location.href = "Deletedocument?CompanyKey=" + a + "&documentid=" + m;
        }


    }

    $("#btnadd").click(function () {

        $("#vendordiv table tbody tr:eq(0)").show();
        var vendor = $("#ServiceTitle1 option:selected").map(function () {
            var cln = $("#vendordiv table tbody tr:eq(0)").clone(true);
            $(".venspan", cln).html($(this).text());
            $("#vendordiv table").append(cln);

        }).get();

        $("#vendordiv table tbody tr:eq(0)").hide();

        if ($('#ServiceTitle1_chosen').find('.chosen-choices').find('.search-choice').length == 0) {
            $('.errormessage').html('Please select vendor.');
            $('#Errormanager').show();
            return false;
        }
        else {
            var vendor = $("#Choosen option:selected").map(function () {
                return $(this).val();
            }).get().join(',');
            $('#ServiceKey').val(vendor);
        }

    });

      function bindDocument()
      {
         $.ajax({
            url: '@Url.Action("bindDocument", "PMVendor")',
            cache: false,
             data:
              {
                 CompanyKey: $('#CompanyKey').val()
              },
            success: function (response)
            {

                $("#divFileUploader table tbody tr:not(:first)").remove();
                $("#divFileUploader table tbody tr:eq(0)").show();
                for (var i = 0; i < response.length; i++)
                {
                    var cln = $("#divFileUploader table tbody tr:eq(0)").clone(true);
                    $(".upd-fl", cln).html(response[i].FileName);
                    $("#divFileUploader table").append(cln);
                }
                $("#divFileUploader table tbody tr:eq(0)").hide();
            }
        });
    }


   function bindservice()
   {
       debugger;
       $.ajax({

            url: '@Url.Action("bindservice", "PMVendor")',
            cache: false,
             data:
              {
                 CompanyKey: $('#CompanyKey').val()
              },
            success: function (response)
            {

                $("#divservc table tbody tr:not(:first)").remove();
                $("#divservc table tbody tr:eq(0)").show();
                for (var i = 0; i < response.length; i++)
                {
                    var cln = $("#divservc table tbody tr:eq(0)").clone(true);
                    $(".ser-fl", cln).html(response[i].Title);
                    $("#divservc table").append(cln);
                }
                $("#divservc table tbody tr:eq(0)").hide();
            }
        });
    }

</script>